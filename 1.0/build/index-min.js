/*!build time : 2013-09-29 4:35:34 PM*/
KISSY.add("gallery/nbselect/1.0/plugin/kscroll",function(a,b,c){function d(a,b){var c=this;d.superclass.constructor.call(c,b),c._init(a)}var e=b.all,f=function(a){return 0>a?-a:a},g=function(a){return isNaN(parseInt(a))?0:parseInt(a)},h=function(a){return a.charAt(0).toUpperCase()+a.substring(1)},i='<div class="{prefix}scrollbar"><div class="{prefix}track" ><div class="{prefix}drag" ><div class="{prefix}dragtop"></div><div class="{prefix}dragbottom"></div><div class="{prefix}dragcenter"></div></div></div></div>',j='<div class="{prefix}arrow{type}"><a href="javascript:void(\'scroll {type}\')" >scroll {type}</a></div>';return a.extend(d,c,{_init:function(a){var b=this,c="."+b.get("prefix");a=b._wrap(e(a)),b.set("container",a),b.set("body",a.one(c+"body")),b.set("track",a.one(c+"track")),b.set("drag",this.get("track").one(c+"drag")),b.get("allowArrow")?(b.set("arrowUp",a.one(c+"arrowup")),b.arrowUpHeight=b.get("arrowUp").outerHeight(),b.set("arrowDown",a.one(c+"arrowdown")),b.arrowDownHeight=b.get("arrowDown").outerHeight()):b.arrowUpHeight=b.arrowDownHeight=0,b._bindEvt(),b._setSize()},destroy:function(){var a=this,b=a.get("container"),c=(a.get("track"),a.get("arrowUp")),d=a.get("arrowDown"),e=b.children().item(0);c&&c.remove(),d&&d.remove(),e.insertBefore(b),b.remove(),e.css(a.__backup),e.removeClass(a.get("prefix")+"body")},_wrap:function(b){var c=this,d=c.get("prefix"),f=e("<div></div>");6==a.UA.ie&&b.css({overflow:"auto"}),f.insertAfter(b).append(b),f.addClass(d+"container").css({position:"relative",overflow:"hidden",width:b.outerWidth(),height:b.outerHeight()}),f.append(a.substitute(i,{prefix:d}));var g=f.one("."+d+"scrollbar");c.set("scrollBar",g),c.get("allowArrow")&&(g.append(a.substitute(j,{type:"up",prefix:d})),g.append(a.substitute(j,{type:"down",prefix:d})));var h=b[0].style;return c.__backup={position:h.position,top:h.top,left:h.left,width:h.width,height:h.height,overflow:h.overflow},b.css({position:"absolute",top:0,left:0,width:"100%",height:"auto",overflow:"visible"}).addClass(d+"body"),f},_bindArrow:function(a){var b=this,c=h(a),d=0,e=null,f=b.get("prefix"),g=b.get("arrow"+c),i=function(){d+=1;var c=b.get("step"),f="up"==a?c:-c,g=300-25*d;b.scrollByDistance(f),30>=g&&(g=30),e=setTimeout(function(){i()},g)};g.on("click",function(){var c=b.get("step");b.scrollByDistance("up"==a?c:-c)}).on("mousedown",function(){g.addClass(f+"arrow"+a+"-active"),i()}).on("mouseup",function(){g.removeClass(f+"arrow"+a+"-active"),d=0,clearTimeout(e)}).on("mouseleave",function(){g.removeClass(f+"arrow"+a+"-active"),d=0,g.removeClass(f+"arrow"+a+"-hover"),clearTimeout(e)}).on("mouseover",function(){g.addClass(f+"arrow"+a+"-hover")})},_bindDrag:function(){var a,b=e(document),c=this,d=c.get("prefix"),f=0,g=c.get("drag"),h=c.get("track"),i=function(b){var d=h.outerHeight(),e=g.outerHeight(),i=d-e,j=f+(b.pageY-a);0>j&&(j=0),j>i&&(j=i),g.css("top",j),c.scrollByPercent(j/i,1)};g.on("mouseenter",function(){g.addClass(d+"drag-hover")}).on("mouseleave",function(){g.removeClass(d+"drag-hover")}).on("click",function(a){a.stopPropagation()}).on("mousedown",function(c){g.addClass(d+"drag-active"),f=parseInt(g.css("top"))||0,a=c.pageY,b.on("mousemove",i).on("mouseup",function(){g.removeClass(d+"drag-active"),b.detach("mousemove",i),b.detach("mouseup",arguments.callee),a=0})})},_bindHotkey:function(){var b=this,c=b.get("body"),d=b.get("container"),e=function(a){var b=g(c.css("top"));return a>0&&b>=0?!1:0>a&&b+c.outerHeight()<=d.outerHeight()?!1:!0};d.css("outline","none").attr("tabindex",a.guid()).on("keydown",function(a){var c=a.keyCode,d=b.get("step");if(!~"INPUT,TEXTAREA".indexOf(a.target.nodeName.toUpperCase())&&~"38,39,36,40,37,35".indexOf(c)){var f=~"38,39,36".indexOf(c)?d:-d;switch(e(f)&&a.halt(),c){case 38:case 39:b.scrollByDistance(d);break;case 40:case 37:b.scrollByDistance(-d);break;case 36:b.scrollByPercent(0);break;case 35:b.scrollByPercent(1)}}})},_bindTrack:function(){var a=this,b=a.get("prefix"),c=a.get("track");c.unselectable().on("click",function(b){a.scrollByPercent((b.pageY-c.offset().top)/c.outerHeight())}).on("mousedown",function(a){a.preventDefault()}).on("mouseenter",function(){c.addClass(b+"track-hover")}).on("mouseleave",function(){c.removeClass(b+"track-hover")})},_bindBodyDrag:function(){var a=this,b=e(document),c=a.get("body"),d=0,f=function(b){d>b.pageY?a.scrollByDistance(5):a.scrollByDistance(-5)};c.on("mousedown",function(a){d=a.pageY,b.on("mousemove",f).on("mouseup",function(){b.detach("mousemove",f),b.detach("mouseup",arguments.callee),d=0})})},_bindContainer:function(){var a=this,b=a.get("body"),c=a.get("container"),d=function(a){var d=g(b.css("top"));return a>0&&d>=0?!1:0>a&&d+b.outerHeight()<=c.outerHeight()?!1:!0};a.get("container").on("mousewheel",function(b){d(b.deltaY)&&b.halt();var c=a.get("step");a.scrollByDistance(b.deltaY>0?c:-c)})},_bindEvt:function(){var a=this;a._bindContainer(),a.get("allowArrow")&&(a._bindArrow("up"),a._bindArrow("down")),a._bindTrack(),a._bindDrag(),a.get("hotkey")===!0&&a._bindHotkey(),a.get("bodydrag")&&a._bindBodyDrag()},resize:function(a,b){var c=this;c.get("container").css({width:a,height:b}),c._setSize()},_setSize:function(){var a,b=this,c=b.get("body").outerHeight(),d=b.get("container").innerHeight(),e=(b.get("arrowUp"),b.get("arrowDown"),b.get("track")),f=b.get("drag"),g=b.arrowUpHeight+b.arrowDownHeight;return d>=c||g>d?(b.get("body").css({top:0}),b.get("scrollBar").hide(),void 0):(b.get("scrollBar").show(),a=(d-g)*d/c,20>a&&(a=20),b.get("step")||b.set("step",Math.max(a/6,10)),e.css({height:d-g,top:b.arrowUpHeight}),f.css({height:a}),void 0)},_scrollBodyToPosition:function(a){var b=this,c=b.get("container"),d=b.get("body"),e=d.outerHeight()-c.innerHeight();0>e||(a>0&&(a=0),f(a)>e&&(a=-e),d.css("top",a))},scrollByDistance:function(a,b){var c=this,d=parseInt(c.get("body").css("top"))+a;c._scrollBodyToPosition(d),b||c._updateBar()},scrollByPercent:function(a,b){var c=this;if(a=parseFloat(a,10),!(isNaN(a)||a>1||0>a)){var d=(c.get("body").outerHeight()-c.get("container").innerHeight())*-a;c._scrollBodyToPosition(d),b||c._updateBar()}},scrollToElement:function(a){if(a=e(a),a.length){var b=this,c=a.offset().top-b.get("body").offset().top;b._scrollBodyToPosition(-c),b._updateBar()}},_updateBar:function(){var a=this,b=a.get("drag"),c=a.get("track").innerHeight()-b.outerHeight(),d=a.get("body"),e=a.get("container"),g=f(parseInt(d.css("top")))/(d.outerHeight()-e.innerHeight());b.css("top",g*c)}},{ATTRS:{prefix:{value:"ks-"},duration:{value:.1},easing:{value:"easeNone"},container:{},body:{},track:{},drag:{},arrowUp:{},allowArrow:{value:!0},arrowDown:{},step:{},scrollBar:{}}}),d},{requires:["node","base"]}),KISSY.add("gallery/nbselect/1.0/index",function(a,b,c,d){function e(b){var c=this;a.mix(c,{domain:"l_"+a.guid(),config:b,_data:null,_dataHash:{},_curNode:null}),c.loadData(c.config.data),c.init()}function f(a){return function(){console.log("\u672a\u5b9e\u73b0\u7684\u65b9\u6cd5\uff1a"+a)}}a.mix(e.prototype,{setCurNode:function(a,b){var c=this;c._curNode=a,b||c.ui_setCurNode(a)},getNodes:function(){var a=this;return a._dataHash},getCurNode:function(){var a=this;return a._curNode},getParents:function(a){for(var b=this,c=[],d=a;d._pid&&(d=b._dataHash[d._pid]);)c.push(d);return c},getNodePath:function(a){var b=this,c=null;return c=b.getParents(a),c.reverse(),c.push(a),c},inNodePath:function(b,c){var d=this,e=d.getNodePath(c);return a.inArray(b,e)},getRoot:function(){var a=this;return a._data},getNode:function(a){var b=this;return b._dataHash[a]},isLastLevel:function(a){if(a.childs)for(var b=0,c=a.childs.length;c>b;b++)if(a.childs[b].childs)return!1;return!0},loadData:function(b){function c(b,e){var f=a.guid();if(b._id=f,d._dataHash[f]=b,e&&(b._pid=e),b.childs)for(var g=0,h=b.childs.length;h>g;g++)c(b.childs[g],f)}var d=this,e=a.clone(b);c(e),d._data=e},reset:function(){var a=this;a.setCurNode(null,!0),a.ui_reset()},init:function(){var a=this;a.ui_init()},ui_init:f("ui_init"),ui_setCurNode:f("ui_setCurNode"),ui_reset:f("ui_setCurNode")});var g=a.extend(function(f){function g(a){a.all("."+k+"-popup-container").css("overflow","visible"),"none"!==a.all("."+k+"-popup-scrollbar").css("display")?a.addClass(k+"-col-has-scr"):a.removeClass(k+"-col-has-scr")}function h(c){var e,f,h,i,l,m=c||j.getCurNode();e=m?j.getNodePath(m):[j.getRoot()],p=m;for(var o=0,s=e.length,t=Math.max(s,n.length);t>o;o++)if(s>o&&e[o].childs){if(f=e[o],f.childs){if(n[o]||(h=a.all('<div style="display:none" class="'+k+"-popup-col "+k+"-popup-lv-"+(o+1)+'" ><h5>{{childLevelName}}</h5><div class="'+k+'-popup-inner tb-clearfix"></div></div>'),n[o]=h,function(a){setTimeout(function(){var b=new d(a.all("."+k+"-popup-inner"),{prefix:k+"-popup-",hotkey:!0,bodydrag:!1,allowArrow:!0});a.data("kscr",b),a.all("."+k+"-popup-container").attr("hidefocus","on"),a.all("."+k+"-popup-container").append(a.all("h5")).siblings("h5").remove(),g(a,100)})}(h),q.append(h)),h=n[o],l=h.data("lv_id")!=f._id){var u=a.mix({firstPinyin:void 0},f,!1),v=new b(r).render(u);h.all("."+k+"-popup-inner").html(v),h.all("h5").text(f.childLevelName)}else h.all(".selected").removeClass("selected");j.isLastLevel(f)?h.addClass(k+"-popup-col-leaf"):h.removeClass(k+"-popup-col-leaf"),i=e[o+1],i&&h.all(".li-id-"+i._id).addClass("selected"),h.show();var w=h.data("kscr");l&&w&&(w.resize(),w.scrollByPercent(0),g(h)),h.data("lv_id",f._id)}}else(h=n[o])&&h.hide()}function i(){s||(m.detach("click",i),a.use("overlay",function(a,b){function d(a){c.contains(q,a.target)||c.contains(m,a.target)||o.hide()}o=new b.Popup({trigger:m,elCls:k+"-popup",content:q,toggle:!0}),o.on("beforeVisibleChange",function(a){a.newVal&&o.align(m,["bl","tl"],[-2,0])}),o.on("show",function(){h(),c.addClass(m,k+"-drop"),c.removeClass(m,k+"-selected"),a.all(document.body).on("mousedown",d)}),o.on("hide",function(){c.removeClass(m,k+"-drop"),a.all(document.body).detach("mousedown",d)}),h(),o.render(),o.show(),s=!1}))}var j=this,k=f.prefix,l=f.noArrow,m=a.all(f.trigger),n=[];[].join("");var o,p,q=a.all('<div class="'+k+'-popup-set"></div>'),r='<ul>{{#each childs}}<li data-nodeID="{{_id}}" class="li-id-{{_id}}" ><span class="tb-icon-pinyin" >{{firstPinyin}}</span><a href="#">{{name}}<i></i>'+(l?"":'<span class="'+k+'-arr" ></span>')+"</a></li>"+"{{/each}}"+"</ul>",s=!1;m.on("click",i),q.delegate("click","li",function(b){b.preventDefault();var c=a.all(b.currentTarget),d=0|c.attr("data-nodeid"),e=j.getNode(d);p&&e.childs&&j.inNodePath(e,p)||(h(e),j.config.ev_afterPickedNode.call(j,e,function(a){a&&j.setCurNode(a)}))}),j.ui_setCurNode=function(a){o&&o.hide(),j.config.ev_afterSetCurNode(a)},j.ui_reset=function(){h()},j.ui_init=function(){},e.apply(j,arguments)},e);return g},{requires:["xtemplate","dom","./plugin/kscroll"]});